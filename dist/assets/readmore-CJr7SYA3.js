import"./modulepreload-polyfill-B5Qt9EMX.js";import{aO as u,aL as i,aM as a,aN as p,aR as E,aV as g,aY as y}from"./firebase-CCtn4aoY.js";const s=document.createElement("link");s.rel="stylesheet";s.href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css";s.integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN";s.crossOrigin="anonymous";document.head.appendChild(s);const r=document.createElement("link");r.rel="stylesheet";r.href="/src/styles/readmore.css";document.head.appendChild(r);const f=new URLSearchParams(window.location.search),m=f.get("itemId");async function d(){if(!m){document.getElementById("item-id").textContent="Not specified",document.getElementById("item-description").textContent="No item selected",document.getElementById("item-name").textContent="Error";return}try{const e=i(a,"items",m),t=await p(e);if(t.exists()){const n=t.data();document.getElementById("item-name").textContent=n.name||"Unnamed Item",document.getElementById("item-id").textContent=m,document.getElementById("item-description").textContent=n.description||"No description";const o=document.createElement("p");o.innerHTML=`<strong>UserName:</strong> ${n.userName||"None"}`;const c=document.getElementById("item-id").parentElement;c.parentElement.insertBefore(o,c)}else document.getElementById("item-description").textContent="Item not found"}catch(e){console.error("Error loading item:",e),document.getElementById("item-description").textContent="Error loading item"}}function h(e){const t=document.getElementById("comments-container");if(t.innerHTML="",!e||e.length===0){t.innerHTML="<p>No comments yet.</p>";return}e.forEach(n=>{const o=document.createElement("div");o.className="comment mb-2 p-2 border rounded",o.innerHTML=`
            <strong>${n.username}</strong>
            <p class="mb-0">${n.text}</p>
            <small class="text-muted">${new Date(n.timestamp).toLocaleString()}</small>
        `,t.appendChild(o)})}async function I(){const e=u.currentUser;if(!e){alert("Please log in to comment"),window.location.assign("/dashboard.html");return}const t=document.getElementById("comment-input").value.trim();if(!t){alert("Please enter a comment");return}try{const n=i(a,"items",m),o={username:e.displayName||e.email.split("@")[0],text:t,timestamp:Date.now()};await g(n,{comments:y(o)}),document.getElementById("comment-input").value=""}catch(n){console.error("Error adding comment:",n),alert("Failed to add comment: "+n.message)}}function l(){if(!m)return;const e=i(a,"items",m);E(e,t=>{if(t.exists()){const n=t.data();h(n.comments)}},t=>{console.error("Error in comments listener:",t)})}function C(){document.getElementById("back-to-webapp").addEventListener("click",()=>{window.location.href="/webapp.html"}),document.getElementById("submit-comment").addEventListener("click",I)}function B(){u.onAuthStateChanged(e=>{e?(document.getElementById("comment-input").disabled=!1,document.getElementById("submit-comment").disabled=!1,d(),l(),C()):(document.getElementById("comment-input").disabled=!0,document.getElementById("submit-comment").disabled=!0,d(),l())})}B();
