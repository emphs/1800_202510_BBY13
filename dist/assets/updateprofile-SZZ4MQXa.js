import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                *//* empty css               */import{aO as p,aL as h,aM as f,aN as B,aQ as E,aw as P,aV as y,aT as D,aS as L}from"./firebase-CCtn4aoY.js";function d(o,e="info"){const t=document.getElementById("updateMessage");t.className=`alert alert-${e} mt-3`,t.style.display="block",t.textContent=o,e==="success"&&setTimeout(()=>{window.location.href="profile.html"},1500)}let u=null;async function b(o){try{const e=h(f,"users",o.uid),a=(await B(e)).data();if(a){document.getElementById("name").value=a.name||"",document.getElementById("email").value=a.email||o.email,document.getElementById("title").value=a.title||"",document.getElementById("bio").value=a.bio||"",document.getElementById("phone").value=a.phone||"",document.getElementById("location").value=a.location||"";const r=document.getElementById("profile-picture");r&&(r.src=a.photoURL||"../../images/default-avatar.svg",r.onerror=()=>{r.src="https://bootdey.com/img/Content/avatar/avatar1.png"})}}catch(e){console.error("Error loading user data:",e),d("Failed to load profile data. Please refresh the page.","danger")}}async function M(o){if(o)try{if(!o.type.startsWith("image/"))throw new Error("Please select an image file");const e=5*1024*1024;if(o.size>e)throw new Error("Image size should be less than 5MB");u=await((a,r,n,l)=>new Promise(g=>{const w=new FileReader;w.readAsDataURL(a),w.onload=v=>{const c=new Image;c.src=v.target.result,c.onload=()=>{const m=document.createElement("canvas");let i=c.width,s=c.height;i>s?i>r&&(s=Math.round(s*r/i),i=r):s>n&&(i=Math.round(i*n/s),s=n),m.width=i,m.height=s,m.getContext("2d").drawImage(c,0,0,i,s);const I=m.toDataURL("image/jpeg",l);g(I)}}}))(o,400,400,.7),document.getElementById("profile-picture").src=u}catch(e){console.error("Error previewing profile picture:",e),d(e.message||"Error previewing profile picture","danger")}}async function N(){const o=p.currentUser;if(!o){alert("Please sign in to migrate posts");return}try{const e=await D(L(f,"items")),t=[];e.forEach(a=>{a.data().userId===o.uid&&t.push(y(a.ref,{userName:o.displayName||"None",lastModified:E()}))}),await Promise.all(t),console.log(`Migrated ${t.length} posts`)}catch(e){throw console.error("Error migrating posts: ",e),e}}async function U(o){o.preventDefault();const e=p.currentUser;if(!e){d("Please log in to update your profile.","danger");return}try{const t={name:document.getElementById("name").value,email:document.getElementById("email").value,title:document.getElementById("title").value,bio:document.getElementById("bio").value,phone:document.getElementById("phone").value,location:document.getElementById("location").value,updatedAt:E()};u&&(t.photoURL=u);const a=t.name;a!==e.displayName&&await P(e,{displayName:a}),t.email!==e.email&&await e.updateEmail(t.email);const r=document.getElementById("newPassword").value,n=document.getElementById("confirmPassword").value,l=document.getElementById("currentPassword").value;if(r||n||l){if(r!==n)throw new Error("New passwords don't match");if(!l)throw new Error("Current password is required to change password");const g=firebase.auth.EmailAuthProvider.credential(e.email,l);await e.reauthenticateWithCredential(g),r&&await e.updatePassword(r)}await y(h(f,"users",e.uid),t),await N(),d("Profile updated! Redirecting...","success")}catch(t){console.error("Error updating profile:",t),d(t.message||"Error updating profile","danger")}}document.addEventListener("DOMContentLoaded",()=>{p.onAuthStateChanged(o=>{if(o){b(o);const e=document.getElementById("profile-upload"),t=document.getElementById("profile-picture");e&&t&&(t.addEventListener("click",()=>{e.click()}),e.addEventListener("change",async r=>{const n=r.target.files[0];n&&await M(n)}));const a=document.getElementById("profile-form");a&&a.addEventListener("submit",U)}else window.location.href="login.html"})});
