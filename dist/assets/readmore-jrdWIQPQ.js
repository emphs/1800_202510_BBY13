import"./modulepreload-polyfill-B5Qt9EMX.js";import{aR as l,aO as i,aP as a,aU as u,aS as p,aV as g,aY as y}from"./firebase-DS_3XjaV.js";const s=document.createElement("link");s.rel="stylesheet";s.href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css";s.integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN";s.crossOrigin="anonymous";document.head.appendChild(s);const c=document.createElement("link");c.rel="stylesheet";c.href="/src/styles/readmore.css";document.head.appendChild(c);const E=new URLSearchParams(window.location.search),o=E.get("itemId");async function r(){if(!o){document.getElementById("item-id").textContent="Not specified",document.getElementById("item-description").textContent="No item selected",document.getElementById("item-name").textContent="Error";return}try{const e=i(a,"items",o),t=await u(e);if(t.exists()){const n=t.data();document.getElementById("item-id").textContent=o,document.getElementById("item-name").textContent=n.name||"Unnamed Item",document.getElementById("item-description").textContent=n.description||"No description"}else document.getElementById("item-description").textContent="Item not found"}catch(e){console.error("Error loading item:",e),document.getElementById("item-description").textContent="Error loading item"}}function f(e){const t=document.getElementById("comments-container");if(t.innerHTML="",!e||e.length===0){t.innerHTML="<p>No comments yet.</p>";return}e.forEach(n=>{const m=document.createElement("div");m.className="comment mb-2 p-2 border rounded",m.innerHTML=`
      <strong>${n.username}</strong>
      <p class="mb-0">${n.text}</p>
      <small class="text-muted">${new Date(n.timestamp).toLocaleString()}</small>
    `,t.appendChild(m)})}async function h(){const e=l.currentUser;if(!e){alert("Please log in to comment"),window.location.assign("/dashboard.html");return}const t=document.getElementById("comment-input").value.trim();if(!t){alert("Please enter a comment");return}try{const n=i(a,"items",o),m={username:e.displayName||e.email.split("@")[0],text:t,timestamp:Date.now()};await g(n,{comments:y(m)}),document.getElementById("comment-input").value=""}catch(n){console.error("Error adding comment:",n),alert("Failed to add comment: "+n.message)}}function d(){if(!o)return;const e=i(a,"items",o);p(e,t=>{if(t.exists()){const n=t.data();f(n.comments)}},t=>{console.error("Error in comments listener:",t)})}function I(){document.getElementById("back-to-webapp").addEventListener("click",()=>{window.location.href="/webapp.html"}),document.getElementById("submit-comment").addEventListener("click",h)}function C(){l.onAuthStateChanged(e=>{e?(document.getElementById("comment-input").disabled=!1,document.getElementById("submit-comment").disabled=!1,r(),d(),I()):(document.getElementById("comment-input").disabled=!0,document.getElementById("submit-comment").disabled=!0,r(),d())})}C();
