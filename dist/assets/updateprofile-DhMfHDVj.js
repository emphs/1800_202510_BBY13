import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                *//* empty css               */import{aO as p,aL as f,aM as w,aN as y,aQ as I,aV as B}from"./firebase-CCtn4aoY.js";function c(a,e="info"){const o=document.getElementById("updateMessage");o.className=`alert alert-${e} mt-3`,o.style.display="block",o.textContent=a,e==="success"&&setTimeout(()=>{window.location.href="profile.html"},1500)}let m=null;async function P(a){try{const e=f(w,"users",a.uid),t=(await y(e)).data();if(t){document.getElementById("name").value=t.name||"",document.getElementById("email").value=t.email||a.email,document.getElementById("title").value=t.title||"",document.getElementById("bio").value=t.bio||"",document.getElementById("phone").value=t.phone||"",document.getElementById("location").value=t.location||"";const r=document.getElementById("profile-picture");r&&(r.src=t.photoURL||"../../images/default-avatar.svg",r.onerror=()=>{r.src="https://bootdey.com/img/Content/avatar/avatar1.png"})}}catch(e){console.error("Error loading user data:",e),c("Failed to load profile data. Please refresh the page.","danger")}}async function D(a){if(a)try{if(!a.type.startsWith("image/"))throw new Error("Please select an image file");const e=5*1024*1024;if(a.size>e)throw new Error("Image size should be less than 5MB");m=await((t,r,n,u)=>new Promise(h=>{const g=new FileReader;g.readAsDataURL(t),g.onload=E=>{const l=new Image;l.src=E.target.result,l.onload=()=>{const d=document.createElement("canvas");let i=l.width,s=l.height;i>s?i>r&&(s=Math.round(s*r/i),i=r):s>n&&(i=Math.round(i*n/s),s=n),d.width=i,d.height=s,d.getContext("2d").drawImage(l,0,0,i,s);const v=d.toDataURL("image/jpeg",u);h(v)}}}))(a,400,400,.7),document.getElementById("profile-picture").src=m}catch(e){console.error("Error previewing profile picture:",e),c(e.message||"Error previewing profile picture","danger")}}async function L(a){a.preventDefault();const e=p.currentUser;if(!e){c("Please log in to update your profile.","danger");return}try{const o={name:document.getElementById("name").value,email:document.getElementById("email").value,title:document.getElementById("title").value,bio:document.getElementById("bio").value,phone:document.getElementById("phone").value,location:document.getElementById("location").value,updatedAt:I()};m&&(o.photoURL=m),o.email!==e.email&&await e.updateEmail(o.email);const t=document.getElementById("newPassword").value,r=document.getElementById("confirmPassword").value,n=document.getElementById("currentPassword").value;if(t||r||n){if(t!==r)throw new Error("New passwords don't match");if(!n)throw new Error("Current password is required to change password");const u=firebase.auth.EmailAuthProvider.credential(e.email,n);await e.reauthenticateWithCredential(u),t&&await e.updatePassword(t)}await B(f(w,"users",e.uid),o),c("Profile updated! Redirecting...","success")}catch(o){console.error("Error updating profile:",o),c(o.message||"Error updating profile","danger")}}document.addEventListener("DOMContentLoaded",()=>{p.onAuthStateChanged(a=>{if(a){P(a);const e=document.getElementById("profile-upload"),o=document.getElementById("profile-picture");e&&o&&(o.addEventListener("click",()=>{e.click()}),e.addEventListener("change",async r=>{const n=r.target.files[0];n&&await D(n)}));const t=document.getElementById("profile-form");t&&t.addEventListener("submit",L)}else window.location.href="login.html"})});
